# =============================================
# Environment Variables for Docker Deployment
# =============================================
# Tento soubor obsahuje konfiguraci pro DVA režimy nasazení:
#
# A) Jednoduchý režim (docker-compose.yml)
#    Frontend + standalone PostgreSQL
#    cp docker/.env.example .env && nano .env
#
# B) Self-hosted Supabase (docker-compose.supabase.yml)
#    Frontend + kompletní Supabase stack
#    cp docker/.env.example .env && nano .env
#
# =============================================

# =============================================
# REŽIM A: Jednoduchý (docker-compose.yml)
# =============================================
# Použijte pokud se připojujete k externímu
# Supabase / Lovable Cloud projektu

VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_PUBLISHABLE_KEY=your-anon-key
VITE_SUPABASE_PROJECT_ID=your-project-id
FRONTEND_PORT=80

# Self-hosted databáze (pouze režim A)
DB_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your-secure-password
POSTGRES_DB=training_system

# =============================================
# REŽIM B: Self-hosted Supabase
# (docker-compose.supabase.yml)
# =============================================

# -------------------------------------------
# SECRETS - ZMĚŇTE PŘED NASAZENÍM!
# -------------------------------------------
# Heslo PostgreSQL databáze
# POSTGRES_PASSWORD=your-super-secret-and-long-postgres-password

# JWT Secret (min 32 znaků)
# Vygenerujte: openssl rand -base64 32
JWT_SECRET=your-super-secret-jwt-token-with-at-least-32-characters-long

# Anon Key (JWT token s rolí 'anon')
# Vygenerujte na: https://supabase.com/docs/guides/self-hosting/docker#generate-api-keys
ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE

# Service Role Key (JWT token s rolí 'service_role')
SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q

# Dashboard přihlášení (Studio)
DASHBOARD_USERNAME=supabase
DASHBOARD_PASSWORD=this_password_is_insecure_and_should_be_updated

# Šifrovací klíče
# Vygenerujte: openssl rand -hex 16
SECRET_KEY_BASE=UpNVntn3cDxHJpq99YMc1T1AQgQpc8kfYTuRgBiYa15BLrx8etQoXz3gZv1/u2oq
VAULT_ENC_KEY=your-32-character-encryption-key
PG_META_CRYPTO_KEY=your-encryption-key-32-chars-min

# -------------------------------------------
# Database
# -------------------------------------------
POSTGRES_HOST=db
POSTGRES_DB=postgres
POSTGRES_PORT=5432

# -------------------------------------------
# Connection Pooler (Supavisor)
# -------------------------------------------
POOLER_PROXY_PORT_TRANSACTION=6543
POOLER_DEFAULT_POOL_SIZE=20
POOLER_MAX_CLIENT_CONN=100
POOLER_TENANT_ID=training-system
POOLER_DB_POOL_SIZE=5

# -------------------------------------------
# API Gateway (Kong)
# -------------------------------------------
KONG_HTTP_PORT=8000
KONG_HTTPS_PORT=8443

# -------------------------------------------
# PostgREST
# -------------------------------------------
PGRST_DB_SCHEMAS=public,storage,graphql_public

# -------------------------------------------
# Auth (GoTrue)
# -------------------------------------------
SITE_URL=http://localhost:80
SITE_DOMAIN=localhost
ADDITIONAL_REDIRECT_URLS=
JWT_EXPIRY=3600
DISABLE_SIGNUP=false

# API_EXTERNAL_URL - DŮLEŽITÉ!
# Tato proměnná ovlivňuje:
#   1. GoTrue Auth (callback URL, ověřovací odkazy v emailech)
#   2. Frontend VITE_SUPABASE_URL (kam se aplikace připojuje jako backend)
# Pro produkční nasazení nastavte na veřejnou URL Kong API Gateway,
# např.: API_EXTERNAL_URL=https://api.example.com:8000
# Pokud není nastavena, fallback je http://{SITE_DOMAIN}:{KONG_HTTP_PORT}
API_EXTERNAL_URL=http://localhost:8000

# Email
ENABLE_EMAIL_SIGNUP=true
ENABLE_EMAIL_AUTOCONFIRM=true
ENABLE_ANONYMOUS_USERS=false

# SMTP pro Auth (potvrzovací emaily, reset hesla)
SMTP_ADMIN_EMAIL=admin@example.com
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-smtp-user
SMTP_PASS=your-smtp-password
SMTP_SENDER_NAME=Training System

# SMTP email odesílatele pro edge funkce (připomínky)
SMTP_FROM=noreply@training.local

# Mailer URL paths
MAILER_URLPATHS_CONFIRMATION=/auth/v1/verify
MAILER_URLPATHS_INVITE=/auth/v1/verify
MAILER_URLPATHS_RECOVERY=/auth/v1/verify
MAILER_URLPATHS_EMAIL_CHANGE=/auth/v1/verify

# Phone auth (vypnuto)
ENABLE_PHONE_SIGNUP=false
ENABLE_PHONE_AUTOCONFIRM=false

# -------------------------------------------
# Studio Dashboard
# -------------------------------------------
STUDIO_DEFAULT_ORGANIZATION=Training System
STUDIO_DEFAULT_PROJECT=Training Management
SUPABASE_PUBLIC_URL=http://localhost:8000

# Image proxy
IMGPROXY_ENABLE_WEBP_DETECTION=true

# -------------------------------------------
# Edge Functions
# -------------------------------------------
FUNCTIONS_VERIFY_JWT=false

# -------------------------------------------
# Analytics (Logflare)
# -------------------------------------------
LOGFLARE_PUBLIC_ACCESS_TOKEN=your-super-secret-and-long-logflare-key-public
LOGFLARE_PRIVATE_ACCESS_TOKEN=your-super-secret-and-long-logflare-key-private

# -------------------------------------------
# Docker
# -------------------------------------------
DOCKER_SOCKET_LOCATION=/var/run/docker.sock

# -------------------------------------------
# CRON - Připomínky
# -------------------------------------------
# Vygenerujte: openssl rand -hex 32
X_CRON_SECRET=your-cron-secret-key

# =============================================
# CRON JOB SETUP (integrován v docker-compose)
# =============================================
# V režimu B je CRON kontejner součástí stacku.
# Připomínky se spouštějí automaticky každou hodinu:
#   :00 - Školení (send-training-reminders)
#   :05 - Technické události (run-deadline-reminders)
#   :10 - PLP prohlídky (run-medical-reminders)
#
# Pro externí CRON (režim A):
# 0  * * * * curl -s -X POST "https://YOUR_SUPABASE_URL/functions/v1/send-training-reminders" -H "x-cron-secret: YOUR_X_CRON_SECRET" >> /var/log/training-reminders.log 2>&1
# 5  * * * * curl -s -X POST "https://YOUR_SUPABASE_URL/functions/v1/run-deadline-reminders" -H "x-cron-secret: YOUR_X_CRON_SECRET" >> /var/log/deadline-reminders.log 2>&1
# 10 * * * * curl -s -X POST "https://YOUR_SUPABASE_URL/functions/v1/run-medical-reminders" -H "x-cron-secret: YOUR_X_CRON_SECRET" >> /var/log/medical-reminders.log 2>&1
# 0  7 * * 1 curl -s -X POST "https://YOUR_SUPABASE_URL/functions/v1/run-reminders" -H "x-cron-secret: YOUR_X_CRON_SECRET" >> /var/log/summary-reminders.log 2>&1
